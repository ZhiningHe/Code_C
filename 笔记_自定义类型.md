**自定义类型**

除了C语言自身带数据类型，还有自定义的数据类型，比如：结构体、枚举、联合。指针、数组也可以看作自定义的数据类型。

---



**结构体**

-  结构的每个成员可以是不同类型的变量。
- 结构体和数组类似，可以整体初始化，但不能整体赋值。
- 结构体名可以忽略，叫做**匿名结构体**。后边的定义的变量也可以忽略。但不可以同时忽略。
- 结构体分配内存的时候必须考虑**内存对齐**。
- 结构体传参最好是传结构体地址，提高效率。
- 

**---内存对齐**

- 为什么？

1.平台原因：不是所有硬件都可以访问任意地址上的任意数据。

2.性能原因：访问为对齐的内存，有时候需要两次。而对齐的内存只需要访问一次。

- 怎么对齐？

1.第一个成员在与结构体变量偏移量为0的地址处。 

2.其他成员变量要对齐到某个数字（对齐数）的整数倍的地址处。

对齐数 = 编译器默认的一个对齐数 与 该成员大小的*较小值*。（VS默认8，Linux默认4）

3.结构体总大小为最大对齐数的整数倍。（每个成员变量都有一个对齐数）

4.结构体有嵌套的话：结构体的最大对齐数是成员的最大对齐数；（区分最大对齐数和结构体大小）

- 是什么？

结构体的内存对齐是拿空间来换取时间的做法。

- 修改默认对齐数

#pragma pack()   //取消设置的默认对齐数，还原为默认

#pragma pack(1)  //设置默认对齐数为8

结构在对齐方式不合适的时候，我么可以自己更改默认对齐数。

**---位段**

位段的声明和结构是类似的，有两个不同：

1.位段的成员必须是 int、unsigned int 或signed int 。 

2.位段的成员名后边有一个冒号和一个数字

```c++
struct A {    
int _a:2;    
int _b:5;    
int _c:10;    
int _d:30; 
};
```

3.跟结构相比，位段可以达到同样的效果，但是可以很好的节省空间，但是有跨平台的问题存在。

4.位段的应用：网络中定义各种协议。存储方式：压缩存储。

5.位段内的类型一致，所以不存在内存对齐。

- 位段的跨平台问题 

1. int 位段被当成有符号数还是无符号数是不确定的。
2.  位段中最大位的数目不能确定。（16位机器最大16，32位机器最大32，写成27，在16位机器会出问 题。 
3.  位段中的成员在内存中从左向右分配，还是从右向左分配标准尚未定义。 
4. 当一个结构包含两个位段，第二个位段成员比较大，无法容纳于第一个位段剩余的位时，是舍弃剩余的 位还是利用，这是不确定的。



---

**枚举**

就是一一列举。 把可能的取值一一列举出来。

- 只能拿枚举常量给枚举变量赋值。

```c
enum Day//星期
{    Mon,    Tues,    Wed,    Thur,    Fri,    Sat,    Sun };
```

- 优点

1. 增加代码的可读性和可维护性
2.   和#deﬁne定义的标识符比较枚举有类型检查，更加严谨。 
3. 防止了命名污染（封装） 
4. 便于调试 
5. 使用方便，一次可以定义多个常量

---

**联合（共用体）**

共用体内的成员公用一块内存。

```c
union Un 
{    
char c;    
int i; 
}un;
un.i = 0x11223344; 
un.c = 0x55; 
printf("%x\n", un.i); //ox11223355 且这个计算机是小端
```

- 特点

联合变量的大小，至少是最大成员的大小（因为联合至少得有能力保存最大的那个成员）

- 应用

判断计算机大小端。

```c
union u
{
    char i;
    int j;
};

u.j = 1;
printf("%c",u.i);
//i->1;小端
//i->0;大端
```

- 计算大小

1.至少是最大成员的大小。

2.对齐到最大对齐数的整数倍处。

```c
union Un1
{   
char c[5];   
int i; 
}; 
union Un2 
{   
short c[7];  
int i; 
}; 
printf("%d\n", sizeof(union Un1));//8
printf("%d\n", sizeof(union Un2))；//16
```



---

结构体和数组操作很相似，仅仅是成员类型规定不同。

位段操作到字节单位，不浪费空间。

枚举和宏很相似，枚举是定义了一堆性质相同的常量，宏一次只能定义一个。

联合只用记住，所有成员都共用一块内存，而且这块内存至少能容纳最大的成员。

